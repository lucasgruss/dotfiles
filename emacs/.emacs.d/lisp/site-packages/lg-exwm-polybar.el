;; lg-exwm-polybar : integration between exwm and polybar

(defvar efs/polybar-process nil
  "Holds the process of the running Polybar instance, if any")

(defun efs/kill-panel ()
  (interactive)
  (when efs/polybar-process
    (ignore-errors
      (kill-process efs/polybar-process)))
  (setq efs/polybar-process nil))

(defun efs/start-panel ()
  (interactive)
  (efs/kill-panel)
  (setq efs/polybar-process (start-process-shell-command "polybar" nil "polybar -r panel")))

(advice-add 'lg/theme-propagate :after (lambda (theme &rest args) (efs/start-panel)))

(defun lg/polybar-minibuffer-hide ()
  (call-process "polybar-msg" nil 0 nil "cmd" "hide"))
(defun lg/polybar-minibuffer-show ()
  (call-process "polybar-msg" nil 0 nil "cmd" "show"))

(provide 'lg-exwm-polybar)
